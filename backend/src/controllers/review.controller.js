const { Review: Review_Ctrl_Rev, User: User_Ctrl_Rev } = require('../models');
exports.createReview = async (req, res) => { const user_id = req.userId; const { movieId } = req.params; const { rating, comment } = req.body; try { const existingReview = await Review_Ctrl_Rev.findOne({ where: { user_id, movie_id: movieId } }); if (existingReview) { return res.status(409).send({ message: "You have already reviewed this movie." }); } const review = await Review_Ctrl_Rev.create({ rating, comment, user_id, movie_id: movieId }); const newReview = await Review_Ctrl_Rev.findByPk(review.review_id, { include: [{ model: User_Ctrl_Rev, attributes: ['name'] }] }); res.status(201).send(newReview); } catch (error) { res.status(500).send({ message: error.message }); } };
